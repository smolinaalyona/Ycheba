import javax.swing.*;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeModel;
import java.awt.*;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;

public class XMLParser extends JFrame {
    private JTree tree;
    private JButton openButton;
    private JFileChooser fileChooser;

    public XMLParser() {
        setTitle("XML Parser");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setSize(600, 400);
        setLocationRelativeTo(null);

        tree = new JTree();
        JScrollPane scrollPane = new JScrollPane(tree);
        add(scrollPane, BorderLayout.CENTER);

        openButton = new JButton("Open XML File");
        fileChooser = new JFileChooser();

        openButton.addActionListener(e -> {
            int result = fileChooser.showOpenDialog(this);
            if (result == JFileChooser.APPROVE_OPTION) {
                File file = fileChooser.getSelectedFile();
                parseXML(file);
            }
        });

        JPanel buttonPanel = new JPanel();
        buttonPanel.add(openButton);
        add(buttonPanel, BorderLayout.NORTH);
    }

    private void parseXML(File file) {
        try (BufferedReader reader = new BufferedReader(new FileReader(file))) {
            String line;
            DefaultMutableTreeNode root = null;
            DefaultMutableTreeNode currentNode = null;
            StringBuilder currentText = null;
            boolean inTag = false;

            while ((line = reader.readLine()) != null) {
                line = line.trim();
                if (line.isEmpty()) continue;

                int i = 0;
                while (i < line.length()) {
                    char c = line.charAt(i);

                    if (c == '<') {
                        if (currentText != null && currentText.length() > 0) {
                            currentNode.add(new DefaultMutableTreeNode("Text: " + currentText.toString().trim()));
                            currentText.setLength(0);
                        }
                        inTag = true;
                        StringBuilder tagName = new StringBuilder();
                        i++;
                        while (i < line.length() && line.charAt(i) != '>' && line.charAt(i) != ' ') {
                            tagName.append(line.charAt(i));
                            i++;
                        }

                        if (tagName.charAt(0) != '/') {
                            DefaultMutableTreeNode newNode = new DefaultMutableTreeNode(tagName.toString());
                            if (root == null) {
                                root = newNode;
                                currentNode = newNode;
                            } else {
                                currentNode.add(newNode);
                                currentNode = newNode;
                            }
                        } else {
                            if (currentNode != null) {
                                currentNode = (DefaultMutableTreeNode) currentNode.getParent();
                            }
                        }

                        while (i < line.length() && line.charAt(i) != '>') {
                            i++;
                        }
                        i++;
                        inTag = false;
                    } else {
                        if (currentText == null) {
                            currentText = new StringBuilder();
                        }
                        currentText.append(c);
                        i++;
                    }
                }
            }

            if (root != null) {
                DefaultTreeModel model = new DefaultTreeModel(root);
                tree.setModel(model);
                for (int row = 0; row < tree.getRowCount(); row++) {
                    tree.expandRow(row);
                }
            }
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error parsing XML: " + e.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
        }
    }

    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> {
            XMLParser parser = new XMLParser();
            parser.setVisible(true);
        });
    }
}
